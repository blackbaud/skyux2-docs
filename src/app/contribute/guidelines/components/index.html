<stache
  pageTitle="Components"
  showTableOfContents="true"
  layout="sidebar">

  <stache-page-summary>
    <p>
      We highly encourage contributions from all SKY UX users, and we ask that you follow these general guidelines so we can review and accept your contributions in a timely fashion.
    </p>
  </stache-page-summary>

  <stache-page-anchor>
    Prerequisites
  </stache-page-anchor>

  <p>Before you contribute, you must install the <a stacheRouterLink="/learn/get-started/prereqs">SKY UX prerequisites</a>.</p>

  <stache-page-anchor>
    Contribution guidelines
  </stache-page-anchor>

  <ul>
    <li>
      <b><a stacheRouterLink="contribute/guidelines" fragment="file-an-issue">File an issue</a> before you start any work.</b> The sooner we can discuss potential code changes, the better.
    </li>
    <li>
      <b>Use the <stache-code>Sky</stache-code> prefix when naming all classes, directives, services, components, etc.</b> This prefix indicates to other contributors that items are owned by SKY UX and not a third-party library. It also prevents potential class-name clashes with other libraries. Keep in mind that while we generally use the uppercase <stache-code>Sky</stache-code> prefix, we also use the <stache-code>sky-</stache-code> prefix in some cases, such as the selector properties in components.
    </li>
    <li>
      <b>All new code must have 100% unit test code coverage.</b> This doesn't guarantee that every use case is accounted for, but anything less than 100% code coverage does guarantee that at least one use case is not accounted for. This can be verified by running tests with <stache-code>npm run watch</stache-code> and viewing the code coverage results in <stache-code>coverage/Chrome xx.x.xxxx/index.html</stache-code>.
    </li>
    <li>
      <b>All new components and visual changes to existing components must be accompanied by visual regression tests.</b> This ensures that future changes to CSS or markup will not cause components to render in an unexpected manner. Visual tests consist of three parts: an HTML template for the component to test, a TypeScript file for the component to test, and the actual file that runs the test using <a href="https://webdriver.io/">webdriver.io</a> and our custom screenshot functions. You can see examples of each part of the visual test process at:
    </li>
    <ul>
      <li>
        <a href="https://github.com/blackbaud/skyux-indicators/blob/master/src/app/visual/alert/index.html">https://github.com/blackbaud/skyux-indicators/blob/master/src/app/visual/alert/index.html</a>
      </li>
      <li>
        <a href="https://github.com/blackbaud/skyux-indicators/blob/master/src/app/visual/alert/alert-visual.component.ts">https://github.com/blackbaud/skyux-indicators/blob/master/src/app/visual/alert/alert-visual.component.ts</a>
      </li>
      <li>
        <a href="https://github.com/blackbaud/skyux-indicators/blob/master/src/app/visual/alert/alert-visual.component.html">https://github.com/blackbaud/skyux-indicators/blob/master/src/app/visual/alert/alert-visual.component.html</a>
      </li>
      <li>
        <a href="https://github.com/blackbaud/skyux-indicators/blob/master/e2e/alert.e2e-spec.ts">https://github.com/blackbaud/skyux-indicators/blob/master/e2e/alert.e2e-spec.ts</a>
      </li>
    </ul>
    <li>
      <b>All new components and changes to existing components must have passing <a stacheRouterLink="/learn/accessibility/test">accessibility tests</a>.</b> This includes automated tests to run during visual regression tests as well as code review and manual keyboard testing.
    </li>
    <li>
      <b>All new components must include demos to accompany the reference documentation in the <a stacheRouterLink="/components">Components section</a> of the SKY UX website.</b> Demos must include all or most features available to the components and examples of all inputs and outputs. In the <a href="https://github.com/blackbaud/skyux2-docs">SKY UX docs repo</a>, you create subfolders for your components in the <stache-code>src/demos</stache-code> folder and add TypeScript and HTML files for the demos. You create <stache-code>{{ '{' }}componentName}-demo.component.html</stache-code> files to provide HTML templates for demos, <stache-code>{{ '{' }}componentName}-demo.component.ts</stache-code> files to handle the logic, and <stache-code>index.ts</stache-code> files to export demos. For examples of existing demos, serve the the <a href="https://github.com/blackbaud/skyux2">SKY UX repo</a> or view the <a stacheRouterLink="/components">components documentation</a>. We recommend that you also <a stacheRouterLink="." fragment="write-documentation">create the reference documentation for your components</a> in a separate pull request.
    </li>
    <li>
      <b>For large changes that include multiple components, please submit changes in several small pull requests instead of one large pull request.</b> (Large being more than 50 files). We ask that you do this for the following reasons:
    </li>
    <ul>
      <li>
        It allows the SKY UX team to review your code in manageable pieces. It's much easier to review 3 pull requests with 50 files than 1 pull request with 150 files.
      </li>
      <li>
        It allows you to get feedback sooner. Catching pervasive coding style changes in a small code review allows you update the rest of your code before you submit it.
      </li>
      <li>
        It demonstrates that your code is modular and does not contain excessive interdependencies. For instance, if Component B is a child component of Component A, you should be able to author, test, document, review, and release Component B in the absence of Component A. If your changes must include both Component A and Component B to be tested and reviewed, then it raises a red flag that the components may be too tightly coupled and should be refactored.
      </li>
    </ul>
    <li>
      <b>If you make an API change that affects inputs and outputs for a component, we recommend that you provide your potential (not working) documentation and demo to the SKY UX team for review.</b> This lets us head off API issues before implementation. Contributors should keep in mind that the API can change in the course of development.
    </li>
  </ul>

  <stache-page-anchor>
    Localization
  </stache-page-anchor>

  <p>
    To declare localization strings, specify a string name and provide the string and a description in the <stache-code>resources_en_US.json</stache-code> file in <stache-code>src/assets/locales</stache-code>. You can reference the localization strings with the <stache-code>skyLibResources</stache-code> pipe or the <stache-code>SkyLibResourcesService</stache-code> service in <stache-code>@skyux/i18n</stache-code>.
    </p>

  <stache-page-anchor>
    Get the code
  </stache-page-anchor>

  <ol>
    <li>
      <a href="https://help.github.com/articles/fork-a-repo/">Fork the repo</a> into your own GitHub repo. To view a list of SKY UX repositories that target different areas of development, see the <a stacheRouterLink="/contribute/packages">packages matrix</a>.
    </li>
    <li>
      Create a branch off of master named after the feature you will contribute. The branch name should be kebab-case (my-new-feature).
    </li>
    <li>
      Clone your repo locally and run <stache-code>nvm use</stache-code> to ensure you have the preferred version of Node.js installed. Next, run <stache-code>npm install</stache-code> to install all required dependencies. For more information on prerequisites, see <a stacheRouterLink="/learn/get-started/prereqs">SKY UX prerequisites</a>.
    </li>
    <li>
      <a stacheRouterLink="." fragment="write-visual-regression-tests">Run your first round of visual regression tests with <stache-code>skyux e2e</stache-code></a>. This establishes baseline screenshots of the components in the master repo so that as you make changes and run your visual regression tests, your changes are validated against the state of the repo before the changes.
    </li>
  </ol>

  <stache-page-anchor>
    Write code
  </stache-page-anchor>

  <ol>
    <li>
      Launch a command prompt, <stache-code>cd</stache-code> to the folder where you cloned your branch, and run <stache-code>skyux watch --coverage library</stache-code>.
    </li>
    <li>
      Launch a second command prompt, <stache-code>cd</stache-code> to the folder where you cloned your branch, and run <stache-code>skyux serve</stache-code>. This launches the visual testing pages where you can view updates based on your code changes. Depending on the nature of your changes, you may need to update the visual tests. Any changes here will impact the visual e2e tests, and you may need to reset the baselines after you make changes to get the build to pass. For more information, see <a stacheRouterLink="." fragment="write-visual-regression-tests">write visual regression tests</a>.
    </li>
    <ul>
      <li>
        SKY UX demos are authored with <a href="https://github.com/blackbaud/skyux-sdk-cli">SKY UX CLI</a>. If this is your first time using SKY UX Builder, you must install the CLI as a global NPM package before you run <stache-code>skyux serve</stache-code>:
      </li>
      <stache-code>npm i -g @skyux-sdk/cli</stache-code>
    </ul>
    <li>
      When you save code changes, the code compiles, static code analysis is performed, unit tests run, and the page refreshes with the latest changes.
    </li>
    <p>
      Keep in mind that when you create components, you must add public exports through <stache-code>./src/app/public/index.ts</stache-code> to allow users to import your component modules. The public exports provide entry points for the bundles that SKY UX deploys.
    </p>
    <p>
      The recommended change detection strategy for SKY UX components is to use <a href="https://angular.io/api/core/ChangeDetectionStrategy">the <stache-code>OnPush</stache-code> property instead of <stache-code>Default</stache-code></a>.
    </p>
  </ol>

  <stache-page-anchor>
    Write documentation
  </stache-page-anchor>

  <p>
    We recommend that you create reference documentation for the <a stacheRouterLink="/components">Components section</a> of the SKY UX website. Component documentation should explain all features of your components, including all properties and events. In the <a href="https://github.com/blackbaud/skyux2-docs">SKY UX docs repo</a>, you create subfolders for your components in the <stache-code>src/app/components</stache-code> folder and document them in index.html files. To create action buttons for the Components section landing page, you add entries in the <stache-code>demo-components.service.ts</stache-code> file.
  </p> 
  
  <p>
    If you do not document your components, the SKY UX team will create the documentation, but we request that you <a href="https://github.com/blackbaud/skyux2-docs/issues">file an issue</a>. However, we strongly encourage you to create your own documentation because it can be useful to uncover issues with your components.
  </p>

  <stache-page-anchor>
    Write unit tests
  </stache-page-anchor>

  <p>
    Your unit test files should end in <stache-code>.spec.ts</stache-code> and reside in the same folders as the components that they test. For example, the test file for <stache-code>foo/foo.component.ts</stache-code> should be <stache-code>foo/foo.component.spec.ts</stache-code>. To run unit tests for a library, run <stache-code>skyux test --coverage library</stache-code>. All test fixtures such as sample components, mock services, etc. should be in a fixtures folder within the component's folder. The existing codebase contains many examples of this pattern, so just follow the patterns in the existing code when you write tests.
  </p>

  <p>
    For new components, we recommend that you reach out to the SKY UX team for a "soft" review of the initial implementation before you write unit tests. This allows you to make requested changes to your code before writing the tests.
  </p>

  <p>
    When your tests run, code coverage results are generated and can be located in <stache-code>coverage/&lt;browser version>/index.html</stache-code>. You can launch this straight from disk and view the SKY UX unit test code coverage results in your default web browser.
  </p>

  <stache-page-anchor>
    Write visual regression tests
  </stache-page-anchor>

  <p>
    During continuous integration builds, SKY UX runs visual regression tests through BrowserStack using <a href="http://www.protractortest.org/">Protractor</a> and <a href="https://github.com/koola/pix-diff">pix-diff</a>. These prerequisites are automatically installed when you run <stache-code>skyux e2e</stache-code> to create and compare screenshots in the <stache-code>skyux-spa-visual-tests/screenshots-baseline-local/</stache-code> folder.
  </p>

  <ol>
    <li>
      To create visual regression tests for a new component, create a folder for the tests in <stache-code>./src/app/visual</stache-code> and add three files:
    </li>

    <ul>
      <li>
        <stache-code>{{ '{' }}componentName}-visual.component.html</stache-code>: The template for the component to render and take a screenshot of.
      </li>
      <li>
        <stache-code>{{ '{' }}componentName}.e2e-spec.ts</stache-code>: The TypeScript code for the component to render and take a screenshot of.
      </li>
      <li>
        <stache-code>index.html</stache-code>: The route file that contains the component to render and take a screenshot of.
      </li>
    </ul>

    <li>
      Add a convenience link to the new folder in the <stache-code>./src/app/index.html</stache-code> file.
    </li>
    <li>
      Add your new tests to the e2e suite by a creating a file at <stache-code>./e2e/{{ '{' }}componentName}.e2e-spec.ts</stache-code>.
    </li>

   </ol>

  <p>
    To run visual regression tests locally, you must first run them locally against the master branch and then run the tests against your feature branch. Keep in mind that you need to use the same monitor and resolution on both set of tests. If your visual regression tests fail, you can check the failed tests at <stache-code>./screenshots-diff-local/diff</stache-code> to find the cause of the failures.
  </p>

  <stache-page-anchor>	
    Submit code	
  </stache-page-anchor>	

  <ol>
    <li>	
      Commit and push your changes to the repo.	
    </li>	
    <li>	
      Submit a pull request.	
    </li>	
  </ol>

</stache>
