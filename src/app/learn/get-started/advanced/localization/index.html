<stache
  pageTitle="Localization"
  showTableOfContents="true">

  <stache-page-summary>
    <p>
      SKY UX Builder provides two methods for localization, <stache-code>skyLibResources</stache-code> for libraries and <stache-code>skyAppResources</stache-code> for SPAs. 
    </p>
  </stache-page-summary>

  <sky-alert alertType="info">
    SKY UX Builder version <stache-code>1.14</stache-code> or later is required for a library to provide its own resource files. The consuming SPA must also be on version <stache-code>1.14</stache-code> or later.
  </sky-alert>

<stache-page-anchor>
  Localization for libraries
</stache-page-anchor>

<p>
  Localization strings for libraries must be set when publishing to NPM because they are not fetched at runtime as they are for SPAs. 
</p>

<h3>
  Install the plugin
</h3>

<ol>
  <li>
    <p>
      Install the SKY UX builder plugin.
    </p>
      <sky-code-block>
        npm install --save-dev --save-exact @skyux-sdk/builder-plugin-skyux
      </sky-code-block>
    </li>
  <li>
    <p>
      Add the plugin to your <stache-code>skyuxconfig.json file</stache-code>.
    </p>
      <sky-code-block>
        {
          "plugins": [
            "@skyux-sdk/builder-plugin-skyux"
          ]
        }  
      </sky-code-block>
  </li>
</ol>

<h3>
  Create a resources provider
</h3>

  <ol>
    <li>
      <p>
        Create a new directory named <stache-code>plugin-resources</stache-code> in <stache-code>./src/app/public/plugin-resources</stache-code>. The name and location of the directory are important.
      </p>
    </li>
    <li>
      <p>
        Inside the <stache-code>plugin-resources</stache-code> directory, create a new file named <stache-code>my-library-resources-provider.ts</stache-code> and replace <stache-code>my-library</stache-code> with the name of your library. In the sample below, replace <stache-code>MyLibrary</stache-code> with the name of your library.
      </p>
    </li>

    <sky-code-block languageType="typescript">
      import {
        SkyAppLocaleInfo,
        SkyLibResourcesProvider
      } from '@skyux/i18n';

      export class MyLibraryResourcesProvider implements SkyLibResourcesProvider {
        public getString: (localeInfo: SkyAppLocaleInfo, name: string) => string;
      }
  </sky-code-block>

  </ol>

  <h3>
    Create a resources module
  </h3>

  <p>
    The resources module will be shared by all modules in your library that need access to locale resources strings.
  </p>

  <p>
    In a shared type directory, create a new Angular module with the content below. Replace <stache-code>MyLibrary</stache-code> with the name of your library.
  </p>

  <sky-code-block languageType="typescript">
    import {
      NgModule
    } from '@angular/core';

    import {
      SkyI18nModule,
      SKY_LIB_RESOURCES_PROVIDERS
    } from '@skyux/i18n';

    import {
      MyLibraryResourcesProvider
    } from '../../plugin-resources/my-library-resources-provider';

    @NgModule({
      providers: [{
        provide: SKY_LIB_RESOURCES_PROVIDERS,
        useClass: MyLibraryResourcesProvider,
        multi: true
      }],
      exports: [
        SkyI18nModule
      ]
    })
    export class MyLibraryResourcesModule { }
  </sky-code-block>

  <h3>
    Additional Setup
  </h3>

  <p>
    Import the new <stache-code>MyLibraryResourcesModule</stache-code> into modules requiring access to locale resource strings. This allows the module to use the <stache-code>skyLibResources</stache-code> pipe and the <stache-code>SkyLibResourcesService</stache-code>.
  </p>

  <stache-code-block languageType="typescript">
    import {
      MyLibraryResourcesModule
    } from './shared/my-library-resources.module';

    @NgModule({
      // ...

      imports: [
        SkyLibraryResourcesModule
      ]

      // ...
    })
    export class MyLibrarySomeOtherModule { }
  </stache-code-block>

  <stache-page-anchor>
    Localization for SPAs
  </stache-page-anchor>

  <p>
    SKY UX Builder provides the capability to declare localization strings <a routerLink="/learn/reference/naming-and-placement">in a JSON file </a> and then reference those strings throughout your SPA using the <stache-code>skyAppResources</stache-code> pipe or the <stache-code>SkyAppResourcesService</stache-code> service in <stache-code>@skyux/i18n</stache-code>.
  </p>

  <h3>
    Declare and reference localization strings
  </h3>

  <ol>
    <li>
      <p>
        In the <stache-code>src/assets/locales</stache-code> folder, open the <stache-code>resources_en_US.json</stache-code> file.
      </p>
    </li>
    <li>
      <p>
        Declare the localization strings to reuse throughout your SPA. Using JSON structure, specify a string name and then provide the string and a description.
      </p>
      <sky-code-block languageType="markup">
        {
          "string_name": {
            "message": "The localization string",
            "_description": "A description of the string for the translator."
          }
        }
      </sky-code-block>
    </li>
    <li>
      <p>
        Reference the localization strings using the <stache-code>skyAppResources</stache-code> pipe or the <stache-code>SkyAppResourcesService</stache-code> service.
      </p>

      <ul>
        <li>
          <p>
            For the <stache-code>skyAppResources</stache-code> pipe, pull the string into your template by name.
          </p>
          <sky-code-block>
            {{ 'string_name' | skyAppResources }}
          </sky-code-block>
        </li>
        <li>
          <p>
            For the <stache-code>SkyAppResourcesService</stache-code> service in <stache-code>@bskyux/i18n</stache-code>, pull the string using <stache-code>getString</stache-code>.
          </p>
          <sky-code-block>
            this.resources.getString('string_name')
              .subscribe((value) => {
                /*do something with the string*/
            });
          </sky-code-block></li>
      </ul>
    </li>
  </ol>

  <h3>
    Use templated strings
  </h3>

  <ol>
    <li>
      <p>
        In the <stache-code>src/assets/locales</stache-code> folder, open the <stache-code>resources_en_US.json</stache-code> file.
      </p>
    </li>
    <li>
      <p>
        Declare templated localization strings with .NET-style tokens in the string that you can replace with dynamic values. For example:
      </p>
      <sky-code-block languageType="markup">
        {
          "string_name": {
            "message": "{0} gave money to the {1} fund",
            "_description": "A string with .NET-style tokens to replace with constituentName and fundName."
          }
        }
      </sky-code-block>
    </li>
    <li>
      <p>
        Reference the localization string using the <stache-code>skyAppResources</stache-code> pipe or the <stache-code>SkyAppResourcesService</stache-code> service and supply values to replace the .NET-style tokens in the string.
      </p>

      <ul>
        <li>
          <p>
            For the <stache-code>skyAppResources</stache-code> pipe, place <stache-code>{{ 'string_name' | skyAppResources }}</stache-code> in your template and insert values for the .NET-style tokens. For example:
          </p>
          <sky-code-block>
            {{ 'string_name' | skyAppResources:constituentName:fundName }}
          </sky-code-block>
        </li>
        <li>
          <p>
            For the <stache-code>SkyAppResourcesService</stache-code> service in <stache-code>@skyux/i18n</stache-code>, pull the string using <stache-code>getString</stache-code> and insert values for the .NET-style tokens. For example:
          </p>
          <sky-code-block>
            this.resources.getString('string_name',constituentName,fundName)
              .subscribe((value) => {
                /*do something with the string*/
            });
          </sky-code-block>
        </li>
      </ul>
    </li>
  </ol>

  <h3>
    Use the default locale provider
  </h3>

  <p>
    If you deploy your application through SKY UX Host and want to use the locale provided by the browser, no additional configuration is necessary.
  </p>

  <h3>
    Provide a custom locale provider
  </h3>

  <p>
    If your application determines the locale through a different mechanism, such as a setting stored in a database, you can provide a custom implementation of the <stache-code>SkyAppLocaleProvider</stache-code>.
  </p>

  <p>
    For example, here is a sample <stache-code>app-extras.module.ts</stache-code> file:
  </p>
  <sky-code-block languageType="typescript">
import { NgModule } from '@angular/core';
import { TestLocaleProvider } from './test-locale-provider'

@NgModule({
  providers: [{
    provide: SkyAppLocaleProvider,
    useClass: TestLocaleProvider
  }]
})
export class AppExtrasModule { }
  </sky-code-block>
  <p>
    And here is a sample <stache-code>test-locale-provider.ts</stache-code> file:
  </p>
  <sky-code-block languageType="typescript">
import { NgModule } from '@angular/core';
import { SkyAppLocaleProvider } from '@skyux/i18n';
import { Observable } from 'rxjs/Observable';

export class TestLocaleProvider extends SkyAppLocaleProvider {
  public getLocaleInfo() {
    return Observable.of({
      locale: 'en-GB'
    });
  }
}
  </sky-code-block>

</stache>
