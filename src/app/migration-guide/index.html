<stache
  layout="container"
  pageTitle="Migrating from SKY UX 2 to 3"
  windowTitle="Migrating from SKY UX 2 to 3"
  showTableOfContents="true"
>

  <stache-page-summary>
    <p>
      This guide will walk you through the steps needed to migrate from SKY UX 2 to SKY UX 3.
    </p>
  </stache-page-summary>

  <stache-page-anchor>
    What's changed
  </stache-page-anchor>

  <p>
    SKY UX 3 seeks to address the following issues with SKY UX 2:
  </p>

  <ul>
    <li>
      SKY UX Core Components/Builder use hard dependencies on specific versions of Angular, RxJS, etc., requiring consumers to wait for SKY UX to upgrade those dependencies. SKY UX 3 moves all dependencies to peer dependencies with a minimum version requirement to allow consumers to upgrade dependencies at will (e.g. consumers can update to a new minor version of Angular on their own).
    </li>
    <li>
      Because SKY UX Core Components is one library, the release cycle increases in size with each new component. SKY UX 3 splits the SKY UX Core Components library up into multiple libraries, each with their own release cycle.
    </li>
    <li>
      New components always start life in the one open-source SKY UX Core Components library, making contributions difficult as contributors either wait for their component to meet the contribution model for SKY UX or to simply not contribute the component back to SKY UX at all. SKY UX 3 will offer new SKY UX Component Library Pipeline that allows for components to start out as private NPM libraries maintained solely by the contributors which can then “graduate” to an open-source library maintained by the SKY UX team.
    </li>
    <li>
      Because SPAs pull in all SKY UX components, load times continue to increase as SKY UX grows. With SKY UX 3, consumers can pull in SKY UX libraries à la carte, decreasing load times and test run times.
    </li>
  </ul>

  <stache-page-anchor>
    About the migration plugin
  </stache-page-anchor>

  <p>
    Most of the work to update your SKY UX application to SKY UX 3 can be done automatically using the SKY UX CLI's migration plugin.  The plugin takes care of the following:
  </p>

  <ul>
    <li>
      <strong>Updates your application's <stache-code>package.json</stache-code> to the latest version of SKY UX and its dependencies</strong> - Since SKY UX no longer has hard dependencies on Angular, RxJS, etc., your application will need to add these as separate dependencies.  The migration plugin will add all of the appropriate dependencies for you.
    </li>
    <li>
      <strong>Adds the appropriate SKY UX modules to your application</strong> - The migration plugin searches your project's source code for known SKY UX components and types, then imports the approprate SKY UX Angular modules to your application's `AppExtrasModule`.
    </li>
    <li>
      <strong>Updates SKY UX import paths</strong> - Since all SKY UX types have moved to new packages, the migration plugin will find SKY UX imports in your TypeScript files and updates the import path to each type's new location.
    </li>
  </ul>

  <stache-page-anchor>
    Preparing your project for migration
  </stache-page-anchor>

  <p>
    Before running the migration plugin, make sure your application's repo is in the appropriate state.  You should create a new branch with no other pending changes.  This way, if an error occurs during the migration, you can simply discard your branch's changes.  Also note that the migration plugin will delete both the <stache-code>node_modules</stache-code> folder, so make sure you haven't copied any files into this directory for testing purposes that you don't have backed up in another location.
  </p>

  <stache-page-anchor>
    Installing the migration plugin
  </stache-page-anchor>

  To install the SKY UX CLI migration plugin, run the following command:

  <stache-code-block>
    npm i @blackbaud/skyux-builder-plugin-migrate -g
  </stache-code-block>

  <stache-page-anchor>
    Running the migration plugin
  </stache-page-anchor>

  <p>
    To run the migration plugin, <stache-code>cd</stache-code> into your application's directory and run the following command:
  </p>

  <stache-code-block>
    skyux migrate
  </stache-code-block>

  <p>
    As the process runs, information about the migration will be reported out to the command line. When the process is complete, you should see a message in the console confirming its success.  If instead you see an error message, see the troubleshooting guide below.
  </p>

  <p>
    Once the migration process has completed, you will need to run <stache-code>npm install</stache-code> to install your project's new dependencies.
  </p>

  <stache-page-anchor>
    Testing the migration
  </stache-page-anchor>

  <p>
    In order to ensure the migration process was successful, you should do the following:
  </p>

  <ul>
    <li>
      <strong>Run <stache-code>skyux watch</stache-code> to launch your appliction</strong> - Successfully launching your application will be the first step in verifying the migration worked properly. Check your browser to see that your application is runnning properly.  If instead of seeing your application running, you see the green wait indicator, this means something likely went wrong.  Consult the troubleshooting guide below for steps to fix it.
    </li>
    <li>
      <strong>Run <stache-code>skyux build</stache-code></strong> - This will ensure there are no problems <a href="https://angular-2-training-book.rangle.io/handout/aot/">AoT-compiling</a> your project.  Sometimes problems that do no present themselves during JIT compilation (such as during <stache-code>skyux watch</stache-code>) will occur during AoT compilation.
    </li>
    <li>
      <strong>Run <stache-code>skyux test</stache-code></strong> - Ensure all of your unit tests continue to pass after the migration.
    </li>
    <li>
      <strong>Run <stache-code>skyux e2e</stache-code> (if applicable)</strong> - If you have e2e tests in your project, you'll want to run those, too.
    </li>
  </ul>

  <stache-page-anchor>
    Troubleshooting the migration
  </stache-page-anchor>

  If you experience any problems during the migration process, look for your issue below along with steps to fix it.  Note that in some cases after identifying the issue and resolving it, you will need to discard your branch's changes and re-run the migration.

  <h3>
    The migration plugin reports the error <stache-code>Error: No package found for &lt;Type&gt;!</stache-code>
  </h3>

  <ul>
    <li>
      Check the name of the type in the error message.  The migration plugin looks for types that are prefixed with <stache-code>Sky</stache-code> and assumes that they are part of the SKY UX library, and if the migration plugin cannot determine which SKY UX library defines that type, it will throw an error.  If the type is one that is defined in your own project, ensure that the type's name does not start with <stache-code>Sky</stache-code>.  If it does, discard your branch's changes, rename the type so that it does not start with <stache-code>Sky</stache-code>, then re-run the migration.
    </li>
    <li>
      If the type is one that is defined by a SKY UX library, it is likely that the type was not accounted for in the migration plugin.  Take note of the type and report it to the SKY UX team by filing an issue on the <a href="https://github.com/blackbaud/skyux-builder-plugin-migrate">migration plugin's GitHub repo</a>.
    </li>
  </ul>

  <h3>
    Running <stache-code>npm install</stache-code> results in an unmet peer dependency warning
  </h3>

  <p>
    The migration plugin makes an effort to not only find the SKY UX libraries required by your application, but also the libraries that <i>those</i> libraries require, by examining each SKY UX library's peer dependencies.  This examination is only one level deep, meaning any peer dependencies of a peer dependency will not be added to your application's dependencies.  In this case, you will need to add the peer dependency to your application's dependencies manually.
  </p>

  <h3>
    Running <stache-code>skyux serve</stache-code> after migration results in the application hanging on the green wait indicator
  </h3>

  <p>
    Open your browser's developer tools and look in the console for any errors.  If you see an error like <stache-code>'sky-foo' is not a known element</stache-code> or <stache-code>Can't bind to 'skyFoo' since it isn't a known property of 'bar'</stache-code>, it is likely that the migration plugin did not account for a SKY UX component or directive when searching for the components and directives used by your application.  Take note of the component or directive and report it to the SKY UX team by filing an issue on the <a href="https://github.com/blackbaud/skyux-builder-plugin-migrate">migration plugin's GitHub repo</a>.
  </p>

  <h3>
    The whitespace around my TypeScript files' <stache-code>import</stache-code> statements is wonky
  </h3>

  <p>
    The migration plugin does its best to preserve existing whitespace when updating your project's import paths.  If you find any odd whitespace issues, like imports being on the same line, it means the migration utility was unable to preserve the file's whitespace.  Fortunately, this does not mean that the migration process itself failed, so you may just fix these instances manually without re-running the migration.
  </p>

</stache>
